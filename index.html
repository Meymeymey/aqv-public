<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Slider Editor - AquaVentus</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #f0f2f5;
      min-height: 100vh;
    }

    /* Header */
    .editor-header {
      background: #003366;
      color: #fff;
      padding: 15px 30px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .editor-header h1 {
      font-size: 1.4rem;
      font-weight: 600;
    }

    .header-actions {
      display: flex;
      gap: 10px;
    }

    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      font-size: 0.95rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-primary {
      background: #0099cc;
      color: #fff;
    }

    .btn-primary:hover {
      background: #007aa3;
    }

    .btn-success {
      background: #28a745;
      color: #fff;
    }

    .btn-success:hover {
      background: #218838;
    }

    .btn-secondary {
      background: #fff;
      color: #003366;
    }

    .btn-secondary:hover {
      background: #e8f4f8;
    }

    .btn-danger {
      background: #dc3545;
      color: #fff;
    }

    .btn-danger:hover {
      background: #c82333;
    }

    .btn-small {
      padding: 6px 12px;
      font-size: 0.85rem;
    }

    /* Main Layout */
    .editor-main {
      display: flex;
      height: calc(100vh - 60px);
    }

    /* Sidebar - Slide List */
    .sidebar {
      width: 280px;
      background: #fff;
      border-right: 1px solid #ddd;
      display: flex;
      flex-direction: column;
    }

    .sidebar-header {
      padding: 15px;
      border-bottom: 1px solid #eee;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .sidebar-header h2 {
      font-size: 1rem;
      color: #333;
    }

    .slide-list {
      flex: 1;
      overflow-y: auto;
      padding: 10px;
    }

    .slide-item {
      background: #f8f9fa;
      border: 2px solid transparent;
      border-radius: 8px;
      padding: 12px;
      margin-bottom: 10px;
      cursor: pointer;
      transition: all 0.2s;
      position: relative;
    }

    .slide-item:hover {
      background: #e8f4f8;
    }

    .slide-item.active {
      border-color: #0099cc;
      background: #e8f4f8;
    }

    .slide-item-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 8px;
    }

    .slide-item-number {
      background: #003366;
      color: #fff;
      width: 24px;
      height: 24px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.75rem;
      font-weight: 600;
    }

    .slide-item-actions {
      display: flex;
      gap: 5px;
    }

    .slide-item-actions button {
      background: none;
      border: none;
      cursor: pointer;
      padding: 4px;
      border-radius: 4px;
      color: #666;
      font-size: 1rem;
    }

    .slide-item-actions button:hover {
      background: #ddd;
    }

    .slide-item-title {
      font-weight: 600;
      color: #333;
      font-size: 0.9rem;
      margin-bottom: 4px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .slide-item-preview {
      font-size: 0.8rem;
      color: #666;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    /* Editor Panel */
    .editor-panel {
      flex: 1;
      padding: 30px;
      overflow-y: auto;
      background: #f0f2f5;
    }

    .editor-card {
      background: #fff;
      border-radius: 12px;
      padding: 25px;
      margin-bottom: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }

    .editor-card h3 {
      color: #003366;
      font-size: 1.1rem;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 2px solid #e8f4f8;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      font-weight: 600;
      color: #333;
      margin-bottom: 8px;
      font-size: 0.9rem;
    }

    .form-group input,
    .form-group textarea {
      width: 100%;
      padding: 12px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 0.95rem;
      font-family: inherit;
      transition: border-color 0.2s;
    }

    .form-group input:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: #0099cc;
    }

    .form-group textarea {
      min-height: 100px;
      resize: vertical;
    }

    .form-group small {
      display: block;
      margin-top: 5px;
      color: #888;
      font-size: 0.8rem;
    }

    .form-row {
      display: flex;
      gap: 15px;
    }

    .form-row .form-group {
      flex: 1;
    }

    .image-preview {
      margin-top: 10px;
      border-radius: 8px;
      overflow: hidden;
      background: #f0f0f0;
      max-height: 200px;
    }

    .image-preview img,
    .image-preview video {
      width: 100%;
      height: 200px;
      object-fit: cover;
      display: block;
    }

    .image-preview-placeholder {
      height: 150px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #999;
      font-size: 0.9rem;
    }

    /* Preview Panel */
    .preview-panel {
      width: 450px;
      background: #1a1a1a;
      padding: 20px;
      display: flex;
      flex-direction: column;
    }

    .preview-header {
      color: #fff;
      font-size: 0.9rem;
      margin-bottom: 15px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .preview-container {
      flex: 1;
      border-radius: 8px;
      overflow: hidden;
      position: relative;
      background: #000;
    }

    /* Mini Slider Preview */
    .mini-slider {
      width: 100%;
      height: 100%;
      position: relative;
    }

    .mini-slide {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      opacity: 0;
      transition: opacity 0.5s;
    }

    .mini-slide.active {
      opacity: 1;
    }

    .mini-slide-image,
    .mini-slide-video {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    /* Media Type Selector */
    .media-type-selector {
      display: flex;
      gap: 10px;
      margin-bottom: 15px;
    }

    .media-type-btn {
      flex: 1;
      padding: 12px 20px;
      border: 2px solid #ddd;
      border-radius: 8px;
      background: #fff;
      cursor: pointer;
      font-size: 0.95rem;
      font-weight: 600;
      color: #666;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .media-type-btn:hover {
      border-color: #0099cc;
      color: #0099cc;
    }

    .media-type-btn.active {
      border-color: #0099cc;
      background: #e8f4f8;
      color: #003366;
    }

    .media-type-icon {
      font-size: 1.2rem;
    }

    .mini-slide-content {
      position: absolute;
      bottom: 40px;
      left: 15px;
      max-width: 70%;
      z-index: 10;
    }

    .mini-slide-title {
      background: #fff;
      color: #003366;
      padding: 8px 12px;
      font-size: 0.9rem;
      font-weight: 700;
      display: inline-block;
    }

    .mini-slide-desc {
      background: rgba(0, 40, 80, 0.85);
      color: #fff;
      padding: 10px 12px;
      font-size: 0.7rem;
      line-height: 1.5;
    }

    .mini-slide-button {
      display: inline-block;
      background: #0099cc;
      color: #fff;
      padding: 6px 14px;
      font-size: 0.7rem;
      font-weight: 600;
      margin-top: 8px;
      border-radius: 4px;
      text-decoration: none;
    }

    /* Parallax Layers Preview */
    .mini-slide-layers {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
    }

    .mini-slide-layer {
      position: absolute;
      top: -5%;
      left: -5%;
      width: 110%;
      height: 110%;
      object-fit: cover;
      transition: transform 0.1s ease-out;
    }

    /* Layer Input Styles */
    .layer-inputs {
      display: none;
    }

    .layer-inputs.active {
      display: block;
    }

    .layer-input-group {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 12px;
      padding: 12px;
      background: #f8f9fa;
      border-radius: 8px;
      border-left: 4px solid #0099cc;
    }

    .layer-input-group.layer-1 { border-left-color: #003366; }
    .layer-input-group.layer-2 { border-left-color: #0066cc; }
    .layer-input-group.layer-3 { border-left-color: #0099cc; }
    .layer-input-group.layer-4 { border-left-color: #00cccc; }
    .layer-input-group.layer-5 { border-left-color: #00cc99; }

    .layer-label {
      min-width: 100px;
      font-weight: 600;
      color: #333;
      font-size: 0.85rem;
    }

    .layer-label small {
      display: block;
      font-weight: normal;
      color: #888;
      font-size: 0.75rem;
    }

    .layer-input-group input {
      flex: 1;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 0.9rem;
    }

    .layer-input-group input:focus {
      outline: none;
      border-color: #0099cc;
    }

    .layer-depth-info {
      background: #e8f4f8;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 15px;
      font-size: 0.85rem;
      color: #333;
    }

    .layer-depth-info strong {
      color: #003366;
    }

    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 60px 30px;
      color: #666;
    }

    .empty-state-icon {
      font-size: 4rem;
      margin-bottom: 20px;
    }

    .empty-state h3 {
      margin-bottom: 10px;
      color: #333;
    }

    /* Modal */
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 1000;
      justify-content: center;
      align-items: center;
    }

    .modal-overlay.active {
      display: flex;
    }

    .modal {
      background: #fff;
      border-radius: 12px;
      padding: 30px;
      max-width: 600px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
    }

    .modal h2 {
      margin-bottom: 20px;
      color: #003366;
    }

    .modal-actions {
      display: flex;
      gap: 10px;
      justify-content: flex-end;
      margin-top: 20px;
    }

    /* Code Output */
    .code-output {
      background: #1e1e1e;
      color: #d4d4d4;
      padding: 20px;
      border-radius: 8px;
      font-family: 'Consolas', 'Monaco', monospace;
      font-size: 0.8rem;
      max-height: 400px;
      overflow: auto;
      white-space: pre-wrap;
      word-break: break-all;
    }

    /* Toast Notification */
    .toast {
      position: fixed;
      bottom: 30px;
      right: 30px;
      background: #28a745;
      color: #fff;
      padding: 15px 25px;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
      transform: translateY(100px);
      opacity: 0;
      transition: all 0.3s;
      z-index: 2000;
    }

    .toast.show {
      transform: translateY(0);
      opacity: 1;
    }

    /* Translate URL Button */
    .link-input-wrapper {
      display: flex;
      gap: 8px;
      align-items: flex-start;
    }

    .link-input-wrapper input {
      flex: 1;
    }

    .btn-translate {
      padding: 12px 14px;
      background: #e8f4f8;
      border: 1px solid #0099cc;
      border-radius: 6px;
      cursor: pointer;
      font-size: 1.1rem;
      transition: all 0.2s;
      flex-shrink: 0;
      height: 46px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .btn-translate:hover {
      background: #0099cc;
    }

    .btn-translate:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .btn-translate.loading {
      animation: pulse 1s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    /* Language Switcher */
    .lang-switcher {
      display: flex;
      gap: 0;
      background: #f0f2f5;
      border-radius: 8px;
      padding: 4px;
      margin-right: 20px;
    }

    .lang-btn {
      padding: 8px 16px;
      border: none;
      background: transparent;
      color: #666;
      font-weight: 600;
      font-size: 0.9rem;
      cursor: pointer;
      border-radius: 6px;
      transition: all 0.2s;
    }

    .lang-btn:hover {
      color: #003366;
    }

    .lang-btn.active {
      background: #003366;
      color: #fff;
    }

    .lang-indicator {
      display: inline-block;
      padding: 2px 8px;
      background: #0099cc;
      color: #fff;
      border-radius: 4px;
      font-size: 0.75rem;
      font-weight: 600;
      margin-left: 8px;
      vertical-align: middle;
    }

    .translation-status {
      font-size: 0.75rem;
      color: #888;
      margin-top: 4px;
    }

    .translation-status.has-translation {
      color: #28a745;
    }

    .translation-status.no-translation {
      color: #dc3545;
    }

    /* German reference text in EN mode */
    .de-reference {
      display: none;
      background: #fff3cd;
      border-left: 3px solid #ffc107;
      padding: 8px 12px;
      margin-bottom: 8px;
      font-size: 0.85rem;
      color: #664d03;
      border-radius: 0 4px 4px 0;
    }

    .de-reference.visible {
      display: block;
    }

    .de-reference-label {
      font-weight: 600;
      font-size: 0.7rem;
      text-transform: uppercase;
      color: #997404;
      margin-bottom: 2px;
    }

    /* Mobile Toggle Buttons */
    .mobile-toggle {
      display: none;
      background: #003366;
      color: #fff;
      border: none;
      padding: 8px 12px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 1.2rem;
    }

    .mobile-nav {
      display: none;
    }

    /* Responsive Styles - Tablet */
    @media (max-width: 1024px) {
      .preview-panel {
        width: 350px;
      }

      .editor-panel {
        padding: 20px;
      }

      .editor-card {
        padding: 20px;
      }

      .header-actions .btn {
        padding: 8px 14px;
        font-size: 0.85rem;
      }
    }

    /* Responsive Styles - Small Tablet / Large Phone */
    @media (max-width: 768px) {
      .editor-header {
        padding: 10px 15px;
        flex-wrap: wrap;
        gap: 10px;
      }

      .editor-header h1 {
        font-size: 1.1rem;
        flex: 1;
      }

      .mobile-toggle {
        display: inline-flex;
        align-items: center;
        justify-content: center;
      }

      .mobile-nav {
        display: flex;
        gap: 8px;
        order: -1;
      }

      .header-actions {
        width: 100%;
        justify-content: flex-end;
        flex-wrap: wrap;
      }

      .header-actions .btn {
        padding: 8px 12px;
        font-size: 0.8rem;
      }

      .language-switcher {
        order: -1;
      }

      .editor-main {
        flex-direction: column;
        height: auto;
        min-height: calc(100vh - 120px);
      }

      .sidebar {
        width: 100%;
        max-height: 0;
        overflow: hidden;
        border-right: none;
        border-bottom: 1px solid #ddd;
        transition: max-height 0.3s ease;
      }

      .sidebar.mobile-open {
        max-height: 300px;
        overflow-y: auto;
      }

      .preview-panel {
        width: 100%;
        max-height: 0;
        overflow: hidden;
        padding: 0;
        transition: max-height 0.3s ease, padding 0.3s ease;
      }

      .preview-panel.mobile-open {
        max-height: 400px;
        padding: 15px;
        overflow: visible;
      }

      .preview-container {
        background: #ffffff !important;
      }

      .mini-slide {
        background: #ffffff !important;
      }

      .mini-slide-image,
      .mini-slide-video,
      .mini-slide-layer {
        object-fit: contain !important;
      }

      .editor-panel {
        padding: 15px;
        order: 1;
      }

      .form-row {
        flex-direction: column;
        gap: 0;
      }

      .editor-card {
        padding: 15px;
        margin-bottom: 15px;
      }

      .editor-card h3 {
        font-size: 1rem;
        margin-bottom: 15px;
      }

      .media-type-selector {
        flex-direction: column;
        gap: 8px;
      }

      .media-type-btn {
        padding: 10px 15px;
      }

      .layer-input-group {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
      }

      .layer-label {
        min-width: auto;
      }

      .layer-input-group input {
        width: 100%;
      }

      .input-with-translate {
        flex-direction: column;
        gap: 8px;
      }

      .input-with-translate input {
        width: 100%;
      }

      .btn-translate,
      .btn-translate-all {
        width: 100%;
        justify-content: center;
      }
    }

    /* Responsive Styles - Phone */
    @media (max-width: 480px) {
      .editor-header {
        padding: 8px 10px;
      }

      .editor-header h1 {
        font-size: 1rem;
      }

      .header-actions {
        gap: 5px;
      }

      .header-actions .btn {
        padding: 6px 10px;
        font-size: 0.75rem;
      }

      .language-switcher {
        gap: 5px;
      }

      .lang-btn {
        padding: 4px 10px;
        font-size: 0.8rem;
      }

      .editor-panel {
        padding: 10px;
      }

      .editor-card {
        padding: 12px;
        border-radius: 8px;
      }

      .form-group input,
      .form-group textarea {
        padding: 10px;
        font-size: 0.9rem;
      }

      .btn {
        padding: 8px 14px;
        font-size: 0.85rem;
      }

      .btn-small {
        padding: 5px 10px;
        font-size: 0.8rem;
      }

      .slide-item {
        padding: 10px;
      }

      .slide-item-number {
        width: 20px;
        height: 20px;
        font-size: 0.7rem;
      }

      .de-reference {
        padding: 6px 10px;
        font-size: 0.8rem;
      }

      .preview-panel.mobile-open {
        max-height: 300px;
        padding: 10px;
      }

      .preview-header {
        font-size: 0.8rem;
      }
    }
  </style>
</head>
<body>

  <!-- Header -->
  <header class="editor-header">
    <div class="mobile-nav">
      <button class="mobile-toggle" id="toggleSidebar" onclick="toggleMobileSidebar()" title="Slides anzeigen">‚ò∞</button>
      <button class="mobile-toggle" id="togglePreview" onclick="toggleMobilePreview()" title="Vorschau anzeigen">üëÅ</button>
    </div>
    <h1>üé† Slider Editor</h1>
    <div class="header-actions">
      <div class="lang-switcher">
        <button class="lang-btn active" id="langDE" onclick="switchLanguage('de')">üá©üá™ DE</button>
        <button class="lang-btn" id="langEN" onclick="switchLanguage('en')">üá¨üáß EN</button>
      </div>
      <button class="btn btn-secondary" onclick="showLoadModal()">üìÇ Laden</button>
      <button class="btn btn-secondary" onclick="showSaveModal()">üíæ Speichern</button>
      <button class="btn btn-success" onclick="showExportModal()">üìã HTML exportieren</button>
    </div>
  </header>

  <!-- Main Content -->
  <main class="editor-main">

    <!-- Sidebar: Slide List -->
    <aside class="sidebar">
      <div class="sidebar-header">
        <h2>Slides</h2>
        <button class="btn btn-primary btn-small" onclick="addSlide()">+ Neue Slide</button>
      </div>
      <div class="slide-list" id="slideList">
        <!-- Slides werden hier dynamisch eingef√ºgt -->
      </div>
    </aside>

    <!-- Editor Panel -->
    <section class="editor-panel" id="editorPanel">
      <div class="empty-state" id="emptyState">
        <div class="empty-state-icon">üé®</div>
        <h3>Keine Slide ausgew√§hlt</h3>
        <p>W√§hle eine Slide aus der Liste oder erstelle eine neue.</p>
      </div>

      <div id="slideEditor" style="display: none;">
        <!-- Inhalt -->
        <div class="editor-card">
          <h3>üìù Inhalt <span class="lang-indicator" id="contentLangIndicator">DE</span></h3>
          <div class="form-group">
            <label>Titel</label>
            <div class="de-reference" id="titleDeRef">
              <div class="de-reference-label">üá©üá™ Deutscher Text:</div>
              <span id="titleDeRefText"></span>
            </div>
            <input type="text" id="slideTitle" placeholder="z.B. Zukunft erleben" oninput="updateSlide()">
            <div class="translation-status" id="titleTranslationStatus"></div>
          </div>
          <div class="form-group">
            <label>Beschreibung</label>
            <div class="de-reference" id="descriptionDeRef">
              <div class="de-reference-label">üá©üá™ Deutscher Text:</div>
              <span id="descriptionDeRefText"></span>
            </div>
            <textarea id="slideDescription" placeholder="Beschreibungstext f√ºr die Slide..." oninput="updateSlide()"></textarea>
            <div class="translation-status" id="descriptionTranslationStatus"></div>
          </div>
        </div>

        <!-- Medien -->
        <div class="editor-card">
          <h3>üé¨ Hintergrund-Medien</h3>

          <div class="media-type-selector">
            <button type="button" class="media-type-btn active" id="mediaTypeImage" onclick="setMediaType('image')">
              <span class="media-type-icon">üñºÔ∏è</span> Bild
            </button>
            <button type="button" class="media-type-btn" id="mediaTypeVideo" onclick="setMediaType('video')">
              <span class="media-type-icon">üé•</span> Video
            </button>
            <button type="button" class="media-type-btn" id="mediaTypeParallax" onclick="setMediaType('parallax')">
              <span class="media-type-icon">üé≠</span> Parallax
            </button>
          </div>

          <!-- Single Image/Video Input -->
          <div id="singleMediaInput">
            <div class="form-group">
              <label id="mediaUrlLabel">Bild-URL</label>
              <input type="text" id="slideImage" placeholder="https://aquaventus.org/wp-content/uploads/..." oninput="updateSlide()">
              <small id="mediaUrlHint">Kopiere die URL aus der WordPress-Mediathek</small>
            </div>
            <div class="image-preview" id="imagePreview">
              <div class="image-preview-placeholder">Medienvorschau</div>
            </div>
          </div>

          <!-- Parallax Layers Input -->
          <div id="parallaxLayersInput" class="layer-inputs">
            <div class="layer-depth-info">
              <strong>Parallax-Ebenen:</strong> Lade bis zu 5 PNG-Ebenen hoch.
              Ebene 1 ist der Hintergrund (bewegt sich am langsamsten),
              Ebene 5 ist der Vordergrund (bewegt sich am schnellsten).
              Leere Ebenen werden √ºbersprungen.
            </div>

            <div class="layer-input-group layer-1">
              <div class="layer-label">Ebene 1<small>Hintergrund</small></div>
              <input type="text" id="layer1" placeholder="https://...bg.png" oninput="updateSlide()">
            </div>

            <div class="layer-input-group layer-2">
              <div class="layer-label">Ebene 2<small>Hinten</small></div>
              <input type="text" id="layer2" placeholder="https://...layer2.png" oninput="updateSlide()">
            </div>

            <div class="layer-input-group layer-3">
              <div class="layer-label">Ebene 3<small>Mitte</small></div>
              <input type="text" id="layer3" placeholder="https://...layer3.png" oninput="updateSlide()">
            </div>

            <div class="layer-input-group layer-4">
              <div class="layer-label">Ebene 4<small>Vorne</small></div>
              <input type="text" id="layer4" placeholder="https://...layer4.png" oninput="updateSlide()">
            </div>

            <div class="layer-input-group layer-5">
              <div class="layer-label">Ebene 5<small>Vordergrund</small></div>
              <input type="text" id="layer5" placeholder="https://...fg.png" oninput="updateSlide()">
            </div>

            <div class="image-preview" id="layersPreview">
              <div class="image-preview-placeholder">Ebenen-Vorschau</div>
            </div>
          </div>

          <!-- Parallax Strength (f√ºr alle Medientypen) -->
          <div class="form-group" style="margin-top:20px; padding-top:15px; border-top:1px solid #eee;">
            <label>Parallax-St√§rke: <span id="parallaxStrengthValue">100%</span></label>
            <input type="range" id="parallaxStrength" min="0" max="200" value="100" oninput="updateParallaxStrength()" style="width:100%;">
            <small>Steuert wie stark sich das Hintergrundbild/Video bei Mausbewegung bewegt. 0% = Aus, 100% = Normal, 200% = Stark</small>
          </div>
        </div>

        <!-- Buttons -->
        <div class="editor-card">
          <h3>üîó Buttons <span class="lang-indicator" id="buttonsLangIndicator">DE</span></h3>
          <div class="form-row">
            <div class="form-group">
              <label>Button 1 Text</label>
              <div class="de-reference" id="button1TextDeRef">
                <div class="de-reference-label">üá©üá™ DE:</div>
                <span id="button1TextDeRefText"></span>
              </div>
              <input type="text" id="slideButton1Text" placeholder="z.B. Mehr erfahren" oninput="updateSlide()">
              <div class="translation-status" id="button1TextTranslationStatus"></div>
            </div>
            <div class="form-group">
              <label>Button 1 Link</label>
              <div class="de-reference" id="button1LinkDeRef">
                <div class="de-reference-label">üá©üá™ DE Link:</div>
                <span id="button1LinkDeRefText" style="word-break:break-all;"></span>
              </div>
              <div class="link-input-wrapper">
                <input type="text" id="slideButton1Link" placeholder="https://..." oninput="updateSlide()">
                <button type="button" class="btn-translate" onclick="translateUrl('slideButton1Link')" title="URL √ºbersetzen (hreflang)">üåê</button>
              </div>
              <small>Klicke üåê um die √úbersetzung der URL zu finden</small>
              <div class="translation-status" id="button1LinkTranslationStatus"></div>
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>Button 2 Text (optional)</label>
              <div class="de-reference" id="button2TextDeRef">
                <div class="de-reference-label">üá©üá™ DE:</div>
                <span id="button2TextDeRefText"></span>
              </div>
              <input type="text" id="slideButton2Text" placeholder="z.B. Kontakt" oninput="updateSlide()">
              <div class="translation-status" id="button2TextTranslationStatus"></div>
            </div>
            <div class="form-group">
              <label>Button 2 Link</label>
              <div class="de-reference" id="button2LinkDeRef">
                <div class="de-reference-label">üá©üá™ DE Link:</div>
                <span id="button2LinkDeRefText" style="word-break:break-all;"></span>
              </div>
              <div class="link-input-wrapper">
                <input type="text" id="slideButton2Link" placeholder="https://..." oninput="updateSlide()">
                <button type="button" class="btn-translate" onclick="translateUrl('slideButton2Link')" title="URL √ºbersetzen (hreflang)">üåê</button>
              </div>
              <small>Klicke üåê um die √úbersetzung der URL zu finden</small>
              <div class="translation-status" id="button2LinkTranslationStatus"></div>
            </div>
          </div>
          <!-- Translate All Button (only visible in EN mode) -->
          <div id="translateAllContainer" style="display:none; margin-top:15px; padding-top:15px; border-top:1px solid #eee;">
            <button class="btn btn-primary" onclick="translateAllUrls()" id="translateAllBtn">
              üåê Alle Links √ºbersetzen
            </button>
            <small style="display:block; margin-top:8px; color:#666;">√úbersetzt alle deutschen Links in diesem Slide zu Englisch</small>
          </div>
        </div>
      </div>
    </section>

    <!-- Preview Panel -->
    <aside class="preview-panel">
      <div class="preview-header">
        <span>Live-Vorschau</span>
      </div>
      <div class="preview-container" id="previewContainer">
        <div class="mini-slider" id="miniSlider">
          <div class="image-preview-placeholder" style="height:100%;color:#666;">
            F√ºge Slides hinzu f√ºr die Vorschau
          </div>
        </div>
      </div>
    </aside>

  </main>

  <!-- Export Modal -->
  <div class="modal-overlay" id="exportModal">
    <div class="modal">
      <h2>HTML-Code exportieren <span class="lang-indicator" id="exportLangIndicator">DE</span></h2>
      <p style="margin-bottom:15px;color:#666;">Kopiere diesen Code und f√ºge ihn in das Custom HTML Widget in Elementor ein.<br>
      <strong>Hinweis:</strong> Export nutzt die aktuell gew√§hlte Sprache (<span id="exportLangText">Deutsch</span>).</p>
      <div class="code-output" id="codeOutput"></div>
      <div class="modal-actions">
        <button class="btn btn-secondary" onclick="closeExportModal()">Schlie√üen</button>
        <button class="btn btn-primary" onclick="copyCode()">üìã Code kopieren</button>
        <button class="btn btn-success" onclick="downloadCode()">üíæ Als Datei speichern</button>
      </div>
    </div>
  </div>

  <!-- Load Modal -->
  <div class="modal-overlay" id="loadModal">
    <div class="modal">
      <h2>üìÇ Projekt laden</h2>

      <div style="margin-bottom:20px;">
        <h3 style="font-size:1rem;margin-bottom:10px;color:#003366;">Aus Browser-Speicher laden</h3>
        <p style="color:#666;font-size:0.9rem;margin-bottom:10px;">Lade dein zuletzt gespeichertes Projekt:</p>
        <button class="btn btn-primary" onclick="loadFromStorageAndClose()">üíæ Gespeichertes Projekt laden</button>
      </div>

      <hr style="border:none;border-top:1px solid #eee;margin:20px 0;">

      <div>
        <h3 style="font-size:1rem;margin-bottom:10px;color:#003366;">Aus Datei laden</h3>
        <p style="color:#666;font-size:0.9rem;margin-bottom:10px;">Lade ein exportiertes JSON-Projekt oder eine CSV-Datei:</p>
        <input type="file" id="fileInput" accept=".json,.csv" style="display:none;" onchange="handleFileLoad(event)">
        <button class="btn btn-secondary" onclick="document.getElementById('fileInput').click()">üìÑ Datei ausw√§hlen (.json / .csv)</button>
      </div>

      <div class="modal-actions">
        <button class="btn btn-secondary" onclick="closeLoadModal()">Abbrechen</button>
      </div>
    </div>
  </div>

  <!-- Save Modal -->
  <div class="modal-overlay" id="saveModal">
    <div class="modal">
      <h2>üíæ Projekt speichern</h2>

      <div style="margin-bottom:20px;">
        <h3 style="font-size:1rem;margin-bottom:10px;color:#003366;">Im Browser speichern</h3>
        <p style="color:#666;font-size:0.9rem;margin-bottom:10px;">Speichert automatisch im Browser (bleibt auch nach Schlie√üen erhalten):</p>
        <button class="btn btn-primary" onclick="saveToStorageAndClose()">üíæ Im Browser speichern</button>
      </div>

      <hr style="border:none;border-top:1px solid #eee;margin:20px 0;">

      <div>
        <h3 style="font-size:1rem;margin-bottom:10px;color:#003366;">Als Datei exportieren</h3>
        <p style="color:#666;font-size:0.9rem;margin-bottom:10px;">Speichere das Projekt als Datei zum Teilen oder Backup:</p>
        <div style="display:flex;gap:10px;flex-wrap:wrap;">
          <button class="btn btn-secondary" onclick="downloadProjectJSON()">üìÑ Als JSON speichern</button>
          <button class="btn btn-secondary" onclick="downloadProjectCSV()">üìä Als CSV speichern</button>
        </div>
      </div>

      <div class="modal-actions">
        <button class="btn btn-secondary" onclick="closeSaveModal()">Abbrechen</button>
      </div>
    </div>
  </div>

  <!-- Toast -->
  <div class="toast" id="toast">Gespeichert!</div>

  <script>
    // Slide-Daten
    let slides = [];
    let currentSlideIndex = -1;
    let currentLanguage = 'de'; // 'de' or 'en'

    // Initialisierung
    document.addEventListener('DOMContentLoaded', () => {
      loadFromStorage();
      if (slides.length === 0) {
        // Demo-Slide hinzuf√ºgen
        addSlide();
      }

      // Preview parallax effect
      setupPreviewParallax();
      updateLanguageIndicators();

      // Hide translate buttons in DE mode (default)
      updateTranslateButtonsVisibility(currentLanguage === 'en');
    });

    // Switch language
    function switchLanguage(lang) {
      currentLanguage = lang;

      // Update button states
      document.getElementById('langDE').classList.toggle('active', lang === 'de');
      document.getElementById('langEN').classList.toggle('active', lang === 'en');

      // Update language indicators
      updateLanguageIndicators();

      // Show/hide translate buttons (only in EN mode)
      updateTranslateButtonsVisibility(lang === 'en');

      // Reload current slide with new language
      if (currentSlideIndex >= 0) {
        loadSlideToEditor(slides[currentSlideIndex]);
      }

      // Update preview
      updatePreview();

      showToast(lang === 'de' ? 'Deutsch ausgew√§hlt' : 'English selected');
    }

    // Mobile toggle functions
    function toggleMobileSidebar() {
      const sidebar = document.querySelector('.sidebar');
      const preview = document.querySelector('.preview-panel');
      sidebar.classList.toggle('mobile-open');
      // Close preview if sidebar opens
      if (sidebar.classList.contains('mobile-open')) {
        preview.classList.remove('mobile-open');
      }
    }

    function toggleMobilePreview() {
      const sidebar = document.querySelector('.sidebar');
      const preview = document.querySelector('.preview-panel');
      preview.classList.toggle('mobile-open');
      // Close sidebar if preview opens
      if (preview.classList.contains('mobile-open')) {
        sidebar.classList.remove('mobile-open');
      }
    }

    // Show/hide translate buttons based on language mode
    function updateTranslateButtonsVisibility(isEnglish) {
      // Individual translate buttons
      const translateBtns = document.querySelectorAll('.btn-translate');
      translateBtns.forEach(btn => {
        btn.style.display = isEnglish ? 'flex' : 'none';
      });

      // "Translate All" container
      const translateAllContainer = document.getElementById('translateAllContainer');
      if (translateAllContainer) {
        translateAllContainer.style.display = isEnglish ? 'block' : 'none';
      }
    }

    // Update language indicators in editor
    function updateLanguageIndicators() {
      const langText = currentLanguage === 'de' ? 'DE' : 'EN';
      const indicators = ['contentLangIndicator', 'buttonsLangIndicator'];
      indicators.forEach(id => {
        const el = document.getElementById(id);
        if (el) el.textContent = langText;
      });
    }

    // Update translation status for a field
    function updateTranslationStatus(slide) {
      const fields = [
        { statusId: 'titleTranslationStatus', deField: 'title_de', enField: 'title_en' },
        { statusId: 'descriptionTranslationStatus', deField: 'description_de', enField: 'description_en' },
        { statusId: 'button1TextTranslationStatus', deField: 'button1Text_de', enField: 'button1Text_en' },
        { statusId: 'button1LinkTranslationStatus', deField: 'button1Link_de', enField: 'button1Link_en' },
        { statusId: 'button2TextTranslationStatus', deField: 'button2Text_de', enField: 'button2Text_en' },
        { statusId: 'button2LinkTranslationStatus', deField: 'button2Link_de', enField: 'button2Link_en' }
      ];

      fields.forEach(({ statusId, deField, enField }) => {
        const statusEl = document.getElementById(statusId);
        if (!statusEl) return;

        const hasDE = slide[deField] && slide[deField].trim();
        const hasEN = slide[enField] && slide[enField].trim();

        if (hasDE && hasEN) {
          statusEl.textContent = '‚úì DE + EN vorhanden';
          statusEl.className = 'translation-status has-translation';
        } else if (hasDE && !hasEN) {
          statusEl.textContent = '‚ö† Nur DE vorhanden';
          statusEl.className = 'translation-status no-translation';
        } else if (!hasDE && hasEN) {
          statusEl.textContent = '‚ö† Nur EN vorhanden';
          statusEl.className = 'translation-status no-translation';
        } else {
          statusEl.textContent = '';
          statusEl.className = 'translation-status';
        }
      });
    }

    // Setup preview parallax mouse tracking
    function setupPreviewParallax() {
      const container = document.getElementById('previewContainer');
      container.addEventListener('mousemove', (e) => {
        const rect = container.getBoundingClientRect();
        const x = (e.clientX - rect.left) / rect.width - 0.5;
        const y = (e.clientY - rect.top) / rect.height - 0.5;

        // Apply parallax to layers in preview
        const layers = container.querySelectorAll('.mini-slide.active .mini-slide-layer');
        layers.forEach((layer, index) => {
          const depth = (index + 1) * 0.15; // Increasing depth for each layer
          const moveX = x * 30 * depth;
          const moveY = y * 20 * depth;
          layer.style.transform = `translate(${moveX}px, ${moveY}px)`;
        });

      });

      container.addEventListener('mouseleave', () => {
        const layers = container.querySelectorAll('.mini-slide-layer');
        layers.forEach(layer => {
          layer.style.transform = 'translate(0, 0)';
        });
      });
    }

    // Slide hinzuf√ºgen
    function addSlide() {
      const newSlide = {
        id: Date.now(),
        // Bilingual text fields
        title_de: 'Neue Slide',
        title_en: 'New Slide',
        description_de: '',
        description_en: '',
        button1Text_de: 'Mehr erfahren',
        button1Text_en: 'Learn more',
        button1Link_de: '',
        button1Link_en: '',
        button2Text_de: '',
        button2Text_en: '',
        button2Link_de: '',
        button2Link_en: '',
        // Shared fields (not language-specific)
        image: '',
        mediaType: 'image',
        layers: ['', '', '', '', ''],
        parallaxStrength: 100
      };
      slides.push(newSlide);
      renderSlideList();
      selectSlide(slides.length - 1);
      updatePreview();
    }

    // Slide ausw√§hlen
    function selectSlide(index) {
      currentSlideIndex = index;
      renderSlideList();

      if (index >= 0 && index < slides.length) {
        document.getElementById('emptyState').style.display = 'none';
        document.getElementById('slideEditor').style.display = 'block';
        loadSlideToEditor(slides[index]);
      } else {
        document.getElementById('emptyState').style.display = 'block';
        document.getElementById('slideEditor').style.display = 'none';
      }
    }

    // Slide in Editor laden
    function loadSlideToEditor(slide) {
      // Migrate old format to new bilingual format if needed
      slide = migrateSlideFormat(slide);

      const lang = currentLanguage;
      const isEnglish = lang === 'en';

      // Load language-specific fields based on currentLanguage
      // For links: if EN is empty, use DE value so it can be translated
      document.getElementById('slideTitle').value = slide[`title_${lang}`] || '';
      document.getElementById('slideDescription').value = slide[`description_${lang}`] || '';
      document.getElementById('slideButton1Text').value = slide[`button1Text_${lang}`] || '';
      document.getElementById('slideButton2Text').value = slide[`button2Text_${lang}`] || '';

      // For links: if EN is empty, show DE link so it can be translated with üåê button
      const btn1LinkEN = slide.button1Link_en || '';
      const btn1LinkDE = slide.button1Link_de || '';
      document.getElementById('slideButton1Link').value = isEnglish ? (btn1LinkEN || btn1LinkDE) : btn1LinkDE;

      const btn2LinkEN = slide.button2Link_en || '';
      const btn2LinkDE = slide.button2Link_de || '';
      document.getElementById('slideButton2Link').value = isEnglish ? (btn2LinkEN || btn2LinkDE) : btn2LinkDE;

      // Show/hide German references in EN mode
      updateGermanReferences(slide, isEnglish);

      // Shared fields
      document.getElementById('slideImage').value = slide.image || '';

      // Load layers
      const layers = slide.layers || ['', '', '', '', ''];
      for (let i = 1; i <= 5; i++) {
        document.getElementById('layer' + i).value = layers[i - 1] || '';
      }

      // Parallax strength
      const strength = slide.parallaxStrength !== undefined ? slide.parallaxStrength : 100;
      document.getElementById('parallaxStrength').value = strength;
      document.getElementById('parallaxStrengthValue').textContent = strength + '%';

      // Media Type setzen
      const mediaType = slide.mediaType || 'image';
      setMediaType(mediaType, false);

      if (mediaType === 'parallax') {
        updateLayersPreview(layers);
      } else {
        updateMediaPreview(slide.image, mediaType);
      }

      // Update translation status indicators
      updateTranslationStatus(slide);
    }

    // Show German text references when in EN mode
    function updateGermanReferences(slide, isEnglish) {
      const refs = [
        { refId: 'titleDeRef', textId: 'titleDeRefText', field: 'title_de' },
        { refId: 'descriptionDeRef', textId: 'descriptionDeRefText', field: 'description_de' },
        { refId: 'button1TextDeRef', textId: 'button1TextDeRefText', field: 'button1Text_de' },
        { refId: 'button1LinkDeRef', textId: 'button1LinkDeRefText', field: 'button1Link_de' },
        { refId: 'button2TextDeRef', textId: 'button2TextDeRefText', field: 'button2Text_de' },
        { refId: 'button2LinkDeRef', textId: 'button2LinkDeRefText', field: 'button2Link_de' }
      ];

      refs.forEach(({ refId, textId, field }) => {
        const refEl = document.getElementById(refId);
        const textEl = document.getElementById(textId);
        if (!refEl || !textEl) return;

        const deValue = slide[field] || '';

        if (isEnglish && deValue) {
          textEl.textContent = deValue;
          refEl.classList.add('visible');
        } else {
          refEl.classList.remove('visible');
        }
      });
    }

    // Migrate old slide format to new bilingual format
    function migrateSlideFormat(slide) {
      // If already has bilingual fields, return as-is
      if (slide.title_de !== undefined || slide.title_en !== undefined) {
        return slide;
      }

      // Migrate old fields to new format (assume old content is German)
      const migrated = {
        ...slide,
        title_de: slide.title || '',
        title_en: '',
        description_de: slide.description || '',
        description_en: '',
        button1Text_de: slide.button1Text || '',
        button1Text_en: '',
        button1Link_de: slide.button1Link || '',
        button1Link_en: '',
        button2Text_de: slide.button2Text || '',
        button2Text_en: '',
        button2Link_de: slide.button2Link || '',
        button2Link_en: ''
      };

      // Remove old fields
      delete migrated.title;
      delete migrated.description;
      delete migrated.button1Text;
      delete migrated.button1Link;
      delete migrated.button2Text;
      delete migrated.button2Link;

      return migrated;
    }

    // Parallax strength update
    function updateParallaxStrength() {
      const strength = document.getElementById('parallaxStrength').value;
      document.getElementById('parallaxStrengthValue').textContent = strength + '%';
      if (currentSlideIndex >= 0) {
        slides[currentSlideIndex].parallaxStrength = parseInt(strength);
      }
    }

    // Media Type wechseln
    function setMediaType(type, shouldUpdate = true) {
      const imageBtn = document.getElementById('mediaTypeImage');
      const videoBtn = document.getElementById('mediaTypeVideo');
      const parallaxBtn = document.getElementById('mediaTypeParallax');
      const singleMediaInput = document.getElementById('singleMediaInput');
      const parallaxLayersInput = document.getElementById('parallaxLayersInput');
      const urlLabel = document.getElementById('mediaUrlLabel');
      const urlHint = document.getElementById('mediaUrlHint');
      const urlInput = document.getElementById('slideImage');

      // Reset all buttons
      imageBtn.classList.remove('active');
      videoBtn.classList.remove('active');
      parallaxBtn.classList.remove('active');

      if (type === 'video') {
        videoBtn.classList.add('active');
        singleMediaInput.style.display = 'block';
        parallaxLayersInput.classList.remove('active');
        urlLabel.textContent = 'Video-URL';
        urlHint.textContent = 'Unterst√ºtzte Formate: MP4, WebM. Kopiere die URL aus der WordPress-Mediathek.';
        urlInput.placeholder = 'https://aquaventus.org/wp-content/uploads/...video.mp4';
      } else if (type === 'parallax') {
        parallaxBtn.classList.add('active');
        singleMediaInput.style.display = 'none';
        parallaxLayersInput.classList.add('active');
      } else {
        imageBtn.classList.add('active');
        singleMediaInput.style.display = 'block';
        parallaxLayersInput.classList.remove('active');
        urlLabel.textContent = 'Bild-URL';
        urlHint.textContent = 'Kopiere die URL aus der WordPress-Mediathek';
        urlInput.placeholder = 'https://aquaventus.org/wp-content/uploads/...';
      }

      if (shouldUpdate && currentSlideIndex >= 0) {
        slides[currentSlideIndex].mediaType = type;
        if (type === 'parallax') {
          updateLayersPreview(slides[currentSlideIndex].layers || []);
        } else {
          updateMediaPreview(slides[currentSlideIndex].image, type);
        }
        updatePreview();
      }
    }

    // Slide aktualisieren
    function updateSlide() {
      if (currentSlideIndex < 0) return;

      const mediaType = document.getElementById('mediaTypeParallax').classList.contains('active') ? 'parallax' :
                        document.getElementById('mediaTypeVideo').classList.contains('active') ? 'video' : 'image';

      // Get layers
      const layers = [];
      for (let i = 1; i <= 5; i++) {
        layers.push(document.getElementById('layer' + i).value);
      }

      // Ensure slide has bilingual format
      slides[currentSlideIndex] = migrateSlideFormat(slides[currentSlideIndex]);

      const lang = currentLanguage;

      // Update language-specific fields
      slides[currentSlideIndex][`title_${lang}`] = document.getElementById('slideTitle').value;
      slides[currentSlideIndex][`description_${lang}`] = document.getElementById('slideDescription').value;
      slides[currentSlideIndex][`button1Text_${lang}`] = document.getElementById('slideButton1Text').value;
      slides[currentSlideIndex][`button1Link_${lang}`] = document.getElementById('slideButton1Link').value;
      slides[currentSlideIndex][`button2Text_${lang}`] = document.getElementById('slideButton2Text').value;
      slides[currentSlideIndex][`button2Link_${lang}`] = document.getElementById('slideButton2Link').value;

      // Update shared fields
      slides[currentSlideIndex].image = document.getElementById('slideImage').value;
      slides[currentSlideIndex].mediaType = mediaType;
      slides[currentSlideIndex].layers = layers;
      slides[currentSlideIndex].parallaxStrength = parseInt(document.getElementById('parallaxStrength').value) || 100;

      if (mediaType === 'parallax') {
        updateLayersPreview(layers);
      } else {
        updateMediaPreview(slides[currentSlideIndex].image, mediaType);
      }
      renderSlideList();
      updatePreview();
      updateTranslationStatus(slides[currentSlideIndex]);
    }

    // Medienvorschau aktualisieren
    function updateMediaPreview(url, mediaType) {
      const preview = document.getElementById('imagePreview');
      if (url && url.trim()) {
        if (mediaType === 'video') {
          preview.innerHTML = `<video src="${url}" autoplay loop muted playsinline onerror="this.parentElement.innerHTML='<div class=\\'image-preview-placeholder\\'>Video konnte nicht geladen werden</div>'"></video>`;
        } else {
          preview.innerHTML = `<img src="${url}" alt="Vorschau" onerror="this.parentElement.innerHTML='<div class=\\'image-preview-placeholder\\'>Bild konnte nicht geladen werden</div>'">`;
        }
      } else {
        preview.innerHTML = '<div class="image-preview-placeholder">Medienvorschau</div>';
      }
    }

    // Layers preview
    function updateLayersPreview(layers) {
      const preview = document.getElementById('layersPreview');
      const filledLayers = layers.filter(l => l && l.trim());

      if (filledLayers.length === 0) {
        preview.innerHTML = '<div class="image-preview-placeholder">Ebenen-Vorschau (mindestens eine Ebene ben√∂tigt)</div>';
        return;
      }

      let html = '<div style="position:relative;width:100%;height:200px;overflow:hidden;">';
      layers.forEach((layer, index) => {
        if (layer && layer.trim()) {
          html += `<img src="${layer}" style="position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;z-index:${index + 1};" onerror="this.style.display='none'">`;
        }
      });
      html += '</div>';
      preview.innerHTML = html;
    }

    // Slide-Liste rendern
    function renderSlideList() {
      const list = document.getElementById('slideList');

      if (slides.length === 0) {
        list.innerHTML = '<div style="padding:20px;text-align:center;color:#999;">Keine Slides vorhanden</div>';
        return;
      }

      const lang = currentLanguage;
      list.innerHTML = slides.map((slide, index) => {
        // Migrate if needed for display
        const s = migrateSlideFormat(slide);

        let typeIcon = 'üñºÔ∏è';
        if (s.mediaType === 'video') typeIcon = 'üé•';
        else if (s.mediaType === 'parallax') typeIcon = 'üé≠';

        const title = s[`title_${lang}`] || s.title_de || s.title_en || 'Ohne Titel';
        const description = s[`description_${lang}`] || s.description_de || s.description_en || '';

        return `
        <div class="slide-item ${index === currentSlideIndex ? 'active' : ''}" onclick="selectSlide(${index})">
          <div class="slide-item-header">
            <span class="slide-item-number">${index + 1}</span>
            <div class="slide-item-actions">
              <button onclick="event.stopPropagation(); moveSlide(${index}, -1)" title="Nach oben" ${index === 0 ? 'disabled style="opacity:0.3"' : ''}>‚Üë</button>
              <button onclick="event.stopPropagation(); moveSlide(${index}, 1)" title="Nach unten" ${index === slides.length - 1 ? 'disabled style="opacity:0.3"' : ''}>‚Üì</button>
              <button onclick="event.stopPropagation(); duplicateSlide(${index})" title="Duplizieren">üìã</button>
              <button onclick="event.stopPropagation(); deleteSlide(${index})" title="L√∂schen" style="color:#dc3545">üóëÔ∏è</button>
            </div>
          </div>
          <div class="slide-item-title">${typeIcon} ${title}</div>
          <div class="slide-item-preview">${description ? description.substring(0, 40) + '...' : 'Keine Beschreibung'}</div>
        </div>
      `}).join('');
    }

    // Slide l√∂schen
    function deleteSlide(index) {
      if (slides.length === 1) {
        showToast('Mindestens eine Slide erforderlich');
        return;
      }
      if (confirm('Slide wirklich l√∂schen?')) {
        slides.splice(index, 1);
        if (currentSlideIndex >= slides.length) {
          currentSlideIndex = slides.length - 1;
        }
        renderSlideList();
        selectSlide(currentSlideIndex);
        updatePreview();
      }
    }

    // Slide duplizieren
    function duplicateSlide(index) {
      const original = migrateSlideFormat(slides[index]);
      const copy = { ...original, id: Date.now(), layers: [...(original.layers || [])] };
      if (copy.title_de) copy.title_de = copy.title_de + ' (Kopie)';
      if (copy.title_en) copy.title_en = copy.title_en + ' (Copy)';
      slides.splice(index + 1, 0, copy);
      renderSlideList();
      selectSlide(index + 1);
      updatePreview();
    }

    // Slide verschieben
    function moveSlide(index, direction) {
      const newIndex = index + direction;
      if (newIndex < 0 || newIndex >= slides.length) return;

      [slides[index], slides[newIndex]] = [slides[newIndex], slides[index]];
      currentSlideIndex = newIndex;
      renderSlideList();
      updatePreview();
    }

    // Live-Vorschau aktualisieren
    function updatePreview() {
      const container = document.getElementById('miniSlider');

      if (slides.length === 0) {
        container.innerHTML = '<div class="image-preview-placeholder" style="height:100%;color:#666;">F√ºge Slides hinzu f√ºr die Vorschau</div>';
        return;
      }

      const lang = currentLanguage;
      container.innerHTML = slides.map((slide, index) => {
        // Migrate if needed
        const s = migrateSlideFormat(slide);

        let mediaHTML = '<div style="width:100%;height:100%;background:#333;"></div>';

        if (s.mediaType === 'parallax') {
          const layers = s.layers || [];
          const filledLayers = layers.filter(l => l && l.trim());
          if (filledLayers.length > 0) {
            mediaHTML = '<div class="mini-slide-layers">';
            layers.forEach((layer, i) => {
              if (layer && layer.trim()) {
                mediaHTML += `<img src="${layer}" class="mini-slide-layer" style="z-index:${i + 1};" alt="">`;
              }
            });
            mediaHTML += '</div>';
          }
        } else if (s.image) {
          if (s.mediaType === 'video') {
            mediaHTML = `<video src="${s.image}" class="mini-slide-video" autoplay loop muted playsinline></video>`;
          } else {
            mediaHTML = `<img src="${s.image}" class="mini-slide-image" alt="">`;
          }
        }

        const title = s[`title_${lang}`] || s.title_de || 'Titel';
        const description = s[`description_${lang}`] || s.description_de || '';
        const button1Text = s[`button1Text_${lang}`] || s.button1Text_de || '';

        return `
        <div class="mini-slide ${index === currentSlideIndex ? 'active' : ''}">
          ${mediaHTML}
          <div class="mini-slide-content">
            <div class="mini-slide-title">${title}</div>
            ${description ? `<div class="mini-slide-desc">${description.substring(0, 100)}${description.length > 100 ? '...' : ''}</div>` : ''}
            ${button1Text ? `<span class="mini-slide-button">${button1Text}</span>` : ''}
          </div>
        </div>
      `;
      }).join('');
    }

    // In LocalStorage speichern
    function saveToStorage() {
      localStorage.setItem('aquaventus_slides', JSON.stringify(slides));
      showToast('Gespeichert!');
    }

    // Aus LocalStorage laden
    function loadFromStorage() {
      const saved = localStorage.getItem('aquaventus_slides');
      if (saved) {
        try {
          slides = JSON.parse(saved);
          // Backwards compatibility - migrate all slides to new format
          slides = slides.map(slide => {
            const migrated = migrateSlideFormat(slide);
            return {
              ...migrated,
              mediaType: migrated.mediaType || 'image',
              layers: migrated.layers || ['', '', '', '', ''],
              parallaxStrength: migrated.parallaxStrength !== undefined ? migrated.parallaxStrength : 100
            };
          });
          renderSlideList();
          if (slides.length > 0) {
            selectSlide(0);
          }
          updatePreview();
        } catch (e) {
          console.error('Fehler beim Laden:', e);
        }
      }
    }

    // HTML-Code generieren (uses current language)
    function generateHTML() {
      const lang = currentLanguage;

      // Dots generieren
      let dotsHTML = '';
      slides.forEach((_, i) => {
        dotsHTML += `      <button class="hero-dot${i === 0 ? ' active' : ''}" onclick="goToSlideManual(${i})"></button>\n`;
      });

      // Slides generieren
      let slidesHTML = '';
      slides.forEach((slideRaw, i) => {
        const slide = migrateSlideFormat(slideRaw);

        // Get language-specific content
        const title = slide[`title_${lang}`] || slide.title_de || '';
        const description = slide[`description_${lang}`] || slide.description_de || '';
        const button1Text = slide[`button1Text_${lang}`] || slide.button1Text_de || '';
        const button1Link = slide[`button1Link_${lang}`] || slide.button1Link_de || '';
        const button2Text = slide[`button2Text_${lang}`] || slide.button2Text_de || '';
        const button2Link = slide[`button2Link_${lang}`] || slide.button2Link_de || '';

        let buttonsHTML = '';
        if (button1Link && button1Text) {
          buttonsHTML += `          <a href="${button1Link}" class="hero-slide-button">${button1Text}</a>\n`;
        }
        if (button2Link && button2Text) {
          buttonsHTML += `          <a href="${button2Link}" class="hero-slide-button hero-slide-button--secondary">${button2Text}</a>\n`;
        }

        // Media element(s)
        let mediaHTML = '';
        if (slide.mediaType === 'parallax') {
          const layers = slide.layers || [];
          layers.forEach((layer, layerIndex) => {
            if (layer && layer.trim()) {
              const depth = (layerIndex + 1) * 0.15;
              mediaHTML += `        <img src="${layer}" class="hero-slide-layer" data-depth="${depth.toFixed(2)}" style="z-index:${layerIndex + 1};" alt="">\n`;
            }
          });
        } else if (slide.mediaType === 'video') {
          mediaHTML = `        <video src="${slide.image || ''}" class="hero-slide-media hero-slide-video" autoplay loop muted playsinline></video>`;
        } else {
          mediaHTML = `        <img src="${slide.image || ''}" alt="${title}" class="hero-slide-media hero-slide-image">`;
        }

        const parallaxStrength = slide.parallaxStrength !== undefined ? slide.parallaxStrength : 100;
        slidesHTML += `
      <!-- Slide ${i + 1} -->
      <div class="hero-slide" data-media-type="${slide.mediaType || 'image'}" data-parallax-strength="${parallaxStrength}">
${mediaHTML}
        <div class="hero-slide-content">
          <h2 class="hero-slide-title">${title}</h2>
          <p class="hero-slide-description">
            ${description}
          </p>
${buttonsHTML.trimEnd()}
        </div>
      </div>
`;
      });

      return `<style>
  /* HERO SLIDER - WordPress/Elementor Compatible with Parallax Layers */
  /* WordPress container overrides */
  .elementor-section, .elementor-section-wrap, .elementor-section-boxed, .elementor-container, .elementor-column, .elementor-column-wrap, .elementor-widget-wrap, .elementor-widget-html, .elementor-widget-html .elementor-widget-container { max-width: none !important; width: 100% !important; padding-left: 0 !important; padding-right: 0 !important; margin-left: 0 !important; margin-right: 0 !important; overflow: visible !important; }
  html, body { overflow-x: hidden !important; }
  .hero-slider, .hero-slider * { box-sizing: border-box !important; }
  .hero-slider { position: relative !important; width: 100vw !important; max-width: 100vw !important; height: calc(100vh - 120px) !important; min-height: 400px !important; overflow: hidden !important; display: block !important; margin-left: calc(-50vw + 50%) !important; margin-right: calc(-50vw + 50%) !important; padding: 0 !important; }
  .hero-slider-track { display: flex !important; flex-wrap: nowrap !important; height: 100% !important; width: 100% !important; transition: transform 0.6s ease-in-out !important; gap: 0 !important; }
  .hero-slide { position: relative !important; min-width: 100vw !important; width: 100vw !important; height: 100% !important; flex-shrink: 0 !important; flex-grow: 0 !important; flex-basis: 100vw !important; overflow: hidden !important; }
  .hero-slide-media { position: absolute !important; top: -10% !important; left: -10% !important; right: -10% !important; bottom: -10% !important; width: auto !important; height: auto !important; min-width: 120% !important; min-height: 120% !important; object-fit: cover !important; object-position: center center !important; display: block !important; transition: transform 0.15s ease-out !important; will-change: transform !important; }
  .hero-slide-layer { position: absolute !important; top: -10% !important; left: -10% !important; right: -10% !important; bottom: -10% !important; width: auto !important; height: auto !important; min-width: 120% !important; min-height: 120% !important; object-fit: cover !important; object-position: center center !important; display: block !important; transition: transform 0.15s ease-out !important; will-change: transform !important; }
  .hero-slide-video { object-position: center center !important; }
  .hero-slide-content { position: absolute !important; bottom: 80px !important; left: 5% !important; max-width: 45% !important; z-index: 20 !important; }
  .hero-slide-title { display: inline-block !important; background: #ffffff !important; color: #003366 !important; font-size: 2.5rem !important; font-weight: 700 !important; padding: 15px 25px !important; margin: 0 !important; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important; line-height: 1.2 !important; }
  .hero-slide-description { background: rgba(0, 40, 80, 0.85) !important; color: #ffffff !important; font-size: 1.1rem !important; line-height: 1.7 !important; padding: 20px 25px !important; margin: 0 !important; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important; }
  .hero-slide-button { display: inline-block !important; background: #0099cc !important; color: #ffffff !important; font-size: 1rem !important; font-weight: 600 !important; padding: 12px 28px !important; margin-top: 15px !important; margin-right: 10px !important; text-decoration: none !important; border-radius: 4px !important; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important; transition: background 0.3s, transform 0.2s !important; }
  .hero-slide-button:hover { background: #007aa3 !important; transform: translateY(-2px) !important; color: #ffffff !important; }
  .hero-slide-button--secondary { background: transparent !important; border: 2px solid #ffffff !important; }
  .hero-slide-button--secondary:hover { background: rgba(255, 255, 255, 0.2) !important; }
  .hero-nav-arrow { position: absolute !important; top: 50% !important; transform: translateY(-50%) !important; width: 60px !important; height: 100px !important; display: flex !important; align-items: center !important; justify-content: center !important; cursor: pointer !important; z-index: 30 !important; background: transparent !important; border: none !important; opacity: 0.8 !important; transition: opacity 0.3s !important; }
  .hero-nav-arrow:hover { opacity: 1 !important; }
  .hero-nav-arrow--prev { left: 20px !important; }
  .hero-nav-arrow--next { right: 20px !important; }
  .hero-nav-arrow svg { width: 30px !important; height: 60px !important; stroke: #ffffff !important; stroke-width: 3 !important; fill: none !important; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.5)) !important; }
  .hero-dots { position: absolute !important; bottom: 25px !important; left: 50% !important; transform: translateX(-50%) !important; display: flex !important; gap: 12px !important; z-index: 30 !important; flex-wrap: nowrap !important; }
  .hero-dot { width: 12px !important; height: 12px !important; min-width: 12px !important; min-height: 12px !important; max-width: 12px !important; max-height: 12px !important; border-radius: 50% !important; background: rgba(255, 255, 255, 0.5) !important; border: none !important; cursor: pointer !important; transition: background 0.3s, transform 0.2s !important; padding: 0 !important; flex-shrink: 0 !important; }
  .hero-dot:hover { background: rgba(255, 255, 255, 0.8) !important; transform: scale(1.15) !important; }
  .hero-dot.active { background: #ffffff !important; transform: scale(1.2) !important; }
  /* Tablet */
  @media (max-width: 1024px) {
    .hero-slide-content { max-width: 60% !important; }
    .hero-slide-title { font-size: 2rem !important; }
    .hero-slide-description { font-size: 1rem !important; }
  }
  /* Small Tablet / Large Phone */
  @media (max-width: 768px) {
    .hero-slider { height: auto !important; min-height: 300px !important; background: #ffffff !important; overflow: hidden !important; }
    .hero-slider-track { align-items: flex-start !important; }
    .hero-slide { background: #ffffff !important; display: flex !important; flex-direction: column !important; height: auto !important; min-height: auto !important; }
    .hero-slide-media, .hero-slide-layer { position: relative !important; top: auto !important; left: auto !important; right: auto !important; bottom: auto !important; width: 100% !important; height: auto !important; min-width: 100% !important; max-width: 100% !important; min-height: auto !important; object-fit: contain !important; object-position: center center !important; display: block !important; flex-shrink: 0 !important; }
    .hero-slide-content { position: relative !important; left: auto !important; right: auto !important; bottom: auto !important; max-width: 100% !important; padding: 15px 4% !important; background: #ffffff !important; }
    .hero-slide-title { font-size: 1.4rem !important; padding: 12px 16px !important; line-height: 1.3 !important; display: inline-block !important; }
    .hero-slide-description { font-size: 0.95rem !important; line-height: 1.5 !important; padding: 14px 16px !important; }
    .hero-slide-button { padding: 12px 24px !important; font-size: 0.95rem !important; margin-top: 12px !important; min-height: 44px !important; }
    .hero-nav-arrow { display: none !important; }
    .hero-dots { position: relative !important; bottom: auto !important; left: auto !important; transform: none !important; justify-content: center !important; padding: 15px !important; background: #ffffff !important; border-radius: 0 !important; gap: 15px !important; }
    .hero-dot { width: 12px !important; height: 12px !important; min-width: 44px !important; min-height: 44px !important; max-width: none !important; max-height: none !important; background: transparent !important; position: relative !important; }
    .hero-dot::after { content: '' !important; position: absolute !important; top: 50% !important; left: 50% !important; transform: translate(-50%, -50%) !important; width: 12px !important; height: 12px !important; border-radius: 50% !important; background: #ccc !important; transition: background 0.3s, transform 0.2s !important; }
    .hero-dot.active::after { background: #003366 !important; transform: translate(-50%, -50%) scale(1.2) !important; }
  }
  /* Phone */
  @media (max-width: 480px) {
    .hero-slide-content { padding: 12px 3% !important; }
    .hero-slide-title { font-size: 1.15rem !important; padding: 10px 14px !important; }
    .hero-slide-description { font-size: 0.85rem !important; padding: 12px 14px !important; line-height: 1.45 !important; }
    .hero-slide-button { padding: 12px 20px !important; font-size: 0.9rem !important; display: block !important; text-align: center !important; margin-right: 0 !important; margin-bottom: 8px !important; min-height: 44px !important; }
    .hero-slide-button--secondary { margin-top: 0 !important; }
    .hero-nav-arrow { display: none !important; }
    .hero-dots { position: relative !important; bottom: auto !important; margin-top: 10px !important; gap: 8px !important; padding: 6px 10px !important; }
    .hero-dot { min-width: 36px !important; min-height: 36px !important; }
    .hero-dot::after { width: 8px !important; height: 8px !important; }
  }
  /* Very small phone */
  @media (max-width: 360px) {
    .hero-slide-title { font-size: 1rem !important; padding: 8px 12px !important; }
    .hero-slide-description { font-size: 0.8rem !important; padding: 10px 12px !important; }
    .hero-slide-button { padding: 10px 16px !important; font-size: 0.85rem !important; }
  }
  /* Landscape mobile - keep overlay style */
  @media (max-width: 900px) and (max-height: 500px) and (orientation: landscape) {
    .hero-slider { height: 100vh !important; min-height: 280px !important; background: #ffffff !important; }
    .hero-slide { display: block !important; flex-direction: unset !important; background: #ffffff !important; }
    .hero-slide-media, .hero-slide-layer { position: absolute !important; top: 0 !important; left: 0 !important; right: 0 !important; bottom: 0 !important; width: 100% !important; height: 100% !important; min-width: 100% !important; min-height: 100% !important; object-fit: contain !important; }
    .hero-slide-content { position: absolute !important; bottom: 20px !important; left: 5% !important; max-width: 50% !important; padding: 0 !important; }
    .hero-slide-title { font-size: 1.1rem !important; padding: 8px 14px !important; }
    .hero-slide-description { font-size: 0.8rem !important; padding: 10px 14px !important; max-height: 60px !important; -webkit-line-clamp: 2 !important; }
    .hero-slide-button { padding: 8px 16px !important; font-size: 0.85rem !important; margin-top: 8px !important; }
    .hero-nav-arrow { height: 60px !important; }
    .hero-dots { bottom: 8px !important; }
  }
</style>

<div class="hero-slider">
  <button class="hero-nav-arrow hero-nav-arrow--prev" onclick="changeSlide(-1)">
    <svg viewBox="0 0 30 60"><polyline points="25,5 5,30 25,55"></polyline></svg>
  </button>
  <button class="hero-nav-arrow hero-nav-arrow--next" onclick="changeSlide(1)">
    <svg viewBox="0 0 30 60"><polyline points="5,5 25,30 5,55"></polyline></svg>
  </button>
  <div class="hero-dots">
${dotsHTML}  </div>
  <div class="hero-slider-track">
${slidesHTML}
  </div>
</div>

<script>
(function() {
  var currentSlide = 0;
  var track = document.querySelector('.hero-slider-track');
  var slides = document.querySelectorAll('.hero-slide');
  var dots = document.querySelectorAll('.hero-dot');
  var slider = document.querySelector('.hero-slider');
  var totalSlides = slides.length;
  var autoplayInterval = null;
  var isPaused = false;

  function updateDots() {
    for (var i = 0; i < dots.length; i++) {
      if (i === currentSlide) { dots[i].classList.add('active'); }
      else { dots[i].classList.remove('active'); }
    }
  }

  function goToSlide(index) {
    if (index < 0) { currentSlide = totalSlides - 1; }
    else if (index >= totalSlides) { currentSlide = 0; }
    else { currentSlide = index; }
    track.style.transform = 'translateX(-' + (currentSlide * 100) + '%)';
    updateDots();
  }

  function stopAutoplay() {
    if (autoplayInterval !== null) { clearInterval(autoplayInterval); autoplayInterval = null; }
  }

  function startAutoplay() {
    stopAutoplay();
    if (!isPaused) { autoplayInterval = setInterval(function() { goToSlide(currentSlide + 1); }, 5000); }
  }

  window.changeSlide = function(direction) { goToSlide(currentSlide + direction); startAutoplay(); };
  window.goToSlideManual = function(index) { goToSlide(index); startAutoplay(); };

  slider.onmouseenter = function() { isPaused = true; stopAutoplay(); };
  slider.onmouseleave = function() {
    isPaused = false; startAutoplay();
    // Reset all transforms
    var allLayers = document.querySelectorAll('.hero-slide-layer');
    var allMedia = document.querySelectorAll('.hero-slide-media');
    for (var i = 0; i < allLayers.length; i++) { allLayers[i].style.transform = 'translate(0, 0)'; }
    for (var i = 0; i < allMedia.length; i++) { allMedia[i].style.transform = 'translate(0, 0) scale(1)'; }
  };

  slider.onmousemove = function(e) {
    var rect = slider.getBoundingClientRect();
    var x = (e.clientX - rect.left) / rect.width - 0.5;
    var y = (e.clientY - rect.top) / rect.height - 0.5;
    applyParallax(x, y);
  };

  function applyParallax(x, y) {
    var currentSlideEl = slides[currentSlide];
    if (currentSlideEl) {
      var strength = parseFloat(currentSlideEl.getAttribute('data-parallax-strength')) || 100;
      if (strength === 0) return;
      var multiplier = strength / 100;
      var mediaType = currentSlideEl.getAttribute('data-media-type');
      if (mediaType === 'parallax') {
        var layers = currentSlideEl.querySelectorAll('.hero-slide-layer');
        for (var i = 0; i < layers.length; i++) {
          var depth = parseFloat(layers[i].getAttribute('data-depth')) || 0.3;
          var moveX = x * 50 * depth * multiplier;
          var moveY = y * 35 * depth * multiplier;
          layers[i].style.transform = 'translate(' + moveX + 'px, ' + moveY + 'px)';
        }
      } else {
        var media = currentSlideEl.querySelector('.hero-slide-media');
        if (media) { media.style.transform = 'translate(' + (x * -20 * multiplier) + 'px, ' + (y * -15 * multiplier) + 'px) scale(' + (1 + 0.02 * multiplier) + ')'; }
      }
    }
  }

  // Touch swipe support for slide navigation
  var touchStartX = 0;
  var touchStartY = 0;
  var touchStartTime = 0;
  slider.addEventListener('touchstart', function(e) {
    touchStartX = e.changedTouches[0].screenX;
    touchStartY = e.changedTouches[0].screenY;
    touchStartTime = Date.now();
  }, { passive: true });

  slider.addEventListener('touchend', function(e) {
    var touchEndX = e.changedTouches[0].screenX;
    var diff = touchStartX - touchEndX;
    var timeDiff = Date.now() - touchStartTime;
    if (Math.abs(diff) > 50 && timeDiff < 300) {
      if (diff > 0) { changeSlide(1); } else { changeSlide(-1); }
    }
  }, { passive: true });

  // Touch-based parallax (drag to move layers)
  var isTouching = false;
  var touchCenterX = 0;
  var touchCenterY = 0;
  slider.addEventListener('touchstart', function(e) {
    isTouching = true;
    var rect = slider.getBoundingClientRect();
    touchCenterX = rect.left + rect.width / 2;
    touchCenterY = rect.top + rect.height / 2;
  }, { passive: true });

  slider.addEventListener('touchmove', function(e) {
    if (!isTouching) return;
    var touch = e.changedTouches[0];
    var rect = slider.getBoundingClientRect();
    var x = (touch.clientX - rect.left) / rect.width - 0.5;
    var y = (touch.clientY - rect.top) / rect.height - 0.5;
    applyParallax(x * 1.5, y * 1.5);
  }, { passive: true });

  slider.addEventListener('touchend', function() {
    isTouching = false;
    // Smooth reset
    var allLayers = document.querySelectorAll('.hero-slide-layer');
    var allMedia = document.querySelectorAll('.hero-slide-media');
    for (var i = 0; i < allLayers.length; i++) { allLayers[i].style.transform = 'translate(0, 0)'; }
    for (var i = 0; i < allMedia.length; i++) { allMedia[i].style.transform = 'translate(0, 0) scale(1)'; }
  }, { passive: true });

  // Gyroscope parallax for mobile
  var isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
  if (isMobile && window.DeviceOrientationEvent) {
    var gyroEnabled = false;
    var initialBeta = null;
    var initialGamma = null;
    var gyroSupported = false;

    function handleOrientation(e) {
      if (e.gamma === null && e.beta === null) return;
      gyroSupported = true;
      if (!gyroEnabled) return;
      if (initialBeta === null) { initialBeta = e.beta || 0; initialGamma = e.gamma || 0; }
      var beta = (e.beta || 0) - initialBeta;
      var gamma = (e.gamma || 0) - initialGamma;
      var x = Math.max(-1, Math.min(1, gamma / 15));
      var y = Math.max(-1, Math.min(1, beta / 15));
      applyParallax(x, y);
    }

    if (typeof DeviceOrientationEvent.requestPermission === 'function') {
      // iOS 13+ requires permission
      slider.addEventListener('click', function requestGyro() {
        DeviceOrientationEvent.requestPermission().then(function(state) {
          if (state === 'granted') { gyroEnabled = true; window.addEventListener('deviceorientation', handleOrientation, true); }
        }).catch(console.error);
        slider.removeEventListener('click', requestGyro);
      }, { once: true });
    } else {
      // Android and older iOS - enable directly
      gyroEnabled = true;
      window.addEventListener('deviceorientation', handleOrientation, true);
    }
  }

  startAutoplay();
})();
<\/script>`;
    }

    // Export Modal anzeigen
    function showExportModal() {
      document.getElementById('codeOutput').textContent = generateHTML();
      document.getElementById('exportLangIndicator').textContent = currentLanguage === 'de' ? 'DE' : 'EN';
      document.getElementById('exportLangText').textContent = currentLanguage === 'de' ? 'Deutsch' : 'English';
      document.getElementById('exportModal').classList.add('active');
    }

    // Export Modal schlie√üen
    function closeExportModal() {
      document.getElementById('exportModal').classList.remove('active');
    }

    // Code kopieren
    function copyCode() {
      const code = generateHTML();
      navigator.clipboard.writeText(code).then(() => {
        showToast('Code kopiert!');
      });
    }

    // Als Datei speichern
    function downloadCode() {
      const code = generateHTML();
      const blob = new Blob([code], { type: 'text/html;charset=utf-8' });
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = 'slider.html';
      link.click();
      showToast('Datei heruntergeladen!');
    }

    // Toast anzeigen
    function showToast(message) {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.classList.add('show');
      setTimeout(() => toast.classList.remove('show'), 2000);
    }

    // Modal schlie√üen bei Klick au√üerhalb
    document.getElementById('exportModal').addEventListener('click', (e) => {
      if (e.target === document.getElementById('exportModal')) {
        closeExportModal();
      }
    });

    document.getElementById('loadModal').addEventListener('click', (e) => {
      if (e.target === document.getElementById('loadModal')) {
        closeLoadModal();
      }
    });

    document.getElementById('saveModal').addEventListener('click', (e) => {
      if (e.target === document.getElementById('saveModal')) {
        closeSaveModal();
      }
    });

    // Load Modal
    function showLoadModal() {
      document.getElementById('loadModal').classList.add('active');
    }

    function closeLoadModal() {
      document.getElementById('loadModal').classList.remove('active');
    }

    function loadFromStorageAndClose() {
      const saved = localStorage.getItem('aquaventus_slides');
      if (saved) {
        try {
          slides = JSON.parse(saved);
          // Backwards compatibility - migrate to bilingual format
          slides = slides.map(slide => {
            const migrated = migrateSlideFormat(slide);
            return {
              ...migrated,
              mediaType: migrated.mediaType || 'image',
              layers: migrated.layers || ['', '', '', '', ''],
              parallaxStrength: migrated.parallaxStrength !== undefined ? migrated.parallaxStrength : 100
            };
          });
          renderSlideList();
          if (slides.length > 0) {
            selectSlide(0);
          }
          updatePreview();
          showToast('Projekt geladen!');
        } catch (e) {
          showToast('Fehler beim Laden');
        }
      } else {
        showToast('Kein gespeichertes Projekt gefunden');
      }
      closeLoadModal();
    }

    // Save Modal
    function showSaveModal() {
      document.getElementById('saveModal').classList.add('active');
    }

    function closeSaveModal() {
      document.getElementById('saveModal').classList.remove('active');
    }

    function saveToStorageAndClose() {
      localStorage.setItem('aquaventus_slides', JSON.stringify(slides));
      showToast('Im Browser gespeichert!');
      closeSaveModal();
    }

    function downloadProjectJSON() {
      const data = JSON.stringify(slides, null, 2);
      const blob = new Blob([data], { type: 'application/json' });
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = 'slider_projekt.json';
      link.click();
      showToast('JSON-Datei heruntergeladen!');
      closeSaveModal();
    }

    function downloadProjectCSV() {
      // CSV Header with bilingual fields
      const headers = [
        'Title_DE', 'Title_EN',
        'Description_DE', 'Description_EN',
        'GrafikURL', 'MediaType', 'ParallaxStrength',
        'Link1_DE', 'Link1_EN', 'Link1Text_DE', 'Link1Text_EN',
        'Link2_DE', 'Link2_EN', 'Link2Text_DE', 'Link2Text_EN',
        'Layer1', 'Layer2', 'Layer3', 'Layer4', 'Layer5'
      ];

      // Escape function for CSV values
      const escapeCSV = (val) => {
        if (val === null || val === undefined) return '';
        const str = String(val);
        if (str.includes(';') || str.includes('"') || str.includes('\n')) {
          return '"' + str.replace(/"/g, '""') + '"';
        }
        return str;
      };

      // Build CSV rows
      let csv = headers.join(';') + '\n';

      slides.forEach(slide => {
        // Ensure slide has bilingual format
        const s = migrateSlideFormat(slide);
        const layers = s.layers || ['', '', '', '', ''];
        const row = [
          escapeCSV(s.title_de || ''),
          escapeCSV(s.title_en || ''),
          escapeCSV(s.description_de || ''),
          escapeCSV(s.description_en || ''),
          escapeCSV(s.image || ''),
          escapeCSV(s.mediaType || 'image'),
          escapeCSV(s.parallaxStrength !== undefined ? s.parallaxStrength : 100),
          escapeCSV(s.button1Link_de || ''),
          escapeCSV(s.button1Link_en || ''),
          escapeCSV(s.button1Text_de || ''),
          escapeCSV(s.button1Text_en || ''),
          escapeCSV(s.button2Link_de || ''),
          escapeCSV(s.button2Link_en || ''),
          escapeCSV(s.button2Text_de || ''),
          escapeCSV(s.button2Text_en || ''),
          escapeCSV(layers[0] || ''),
          escapeCSV(layers[1] || ''),
          escapeCSV(layers[2] || ''),
          escapeCSV(layers[3] || ''),
          escapeCSV(layers[4] || '')
        ];
        csv += row.join(';') + '\n';
      });

      // Download with BOM for Excel compatibility
      const BOM = '\uFEFF';
      const blob = new Blob([BOM + csv], { type: 'text/csv;charset=utf-8' });
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = 'slider_projekt_bilingual.csv';
      link.click();
      showToast('CSV-Datei heruntergeladen!');
      closeSaveModal();
    }

    // Datei laden (JSON oder CSV)
    function handleFileLoad(event) {
      const file = event.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = (e) => {
        const content = e.target.result;

        if (file.name.endsWith('.json')) {
          try {
            slides = JSON.parse(content);
            // Backwards compatibility - migrate to bilingual format
            slides = slides.map(slide => {
              const migrated = migrateSlideFormat(slide);
              return {
                ...migrated,
                mediaType: migrated.mediaType || 'image',
                layers: migrated.layers || ['', '', '', '', ''],
                parallaxStrength: migrated.parallaxStrength !== undefined ? migrated.parallaxStrength : 100
              };
            });
            renderSlideList();
            if (slides.length > 0) {
              selectSlide(0);
            }
            updatePreview();
            showToast('JSON geladen!');
          } catch (err) {
            showToast('Fehler beim Lesen der JSON-Datei');
          }
        } else if (file.name.endsWith('.csv')) {
          try {
            loadFromCSV(content);
            showToast('CSV geladen!');
          } catch (err) {
            showToast('Fehler beim Lesen der CSV-Datei');
          }
        }

        closeLoadModal();
      };
      reader.readAsText(file, 'UTF-8');

      // Reset input
      event.target.value = '';
    }

    // CSV laden (supports both old and new bilingual format)
    function loadFromCSV(content) {
      const firstLine = content.split('\n')[0];
      let delimiter = ',';
      if (firstLine.includes('\t')) delimiter = '\t';
      else if (firstLine.includes(';')) delimiter = ';';

      const lines = content.trim().split('\n');
      const headers = lines[0].split(delimiter).map(h => h.trim().replace(/^["']|["']$/g, ''));

      // Detect if this is the new bilingual format
      const isBilingual = headers.includes('Title_DE') || headers.includes('Title_EN');

      slides = [];

      for (let i = 1; i < lines.length; i++) {
        if (!lines[i].trim()) continue;

        const values = parseCSVLine(lines[i], delimiter);

        // Helper to get value by header name
        const getVal = (headerName) => {
          const idx = headers.indexOf(headerName);
          return idx >= 0 ? (values[idx] || '') : '';
        };

        const mediaTypeVal = getVal('MediaType');
        const parallaxStrengthVal = parseInt(getVal('ParallaxStrength')) || 100;

        let slide;

        if (isBilingual) {
          // New bilingual format
          slide = {
            id: Date.now() + i,
            title_de: getVal('Title_DE'),
            title_en: getVal('Title_EN'),
            description_de: getVal('Description_DE'),
            description_en: getVal('Description_EN'),
            button1Link_de: getVal('Link1_DE'),
            button1Link_en: getVal('Link1_EN'),
            button1Text_de: getVal('Link1Text_DE'),
            button1Text_en: getVal('Link1Text_EN'),
            button2Link_de: getVal('Link2_DE'),
            button2Link_en: getVal('Link2_EN'),
            button2Text_de: getVal('Link2Text_DE'),
            button2Text_en: getVal('Link2Text_EN'),
            image: getVal('GrafikURL'),
            mediaType: mediaTypeVal.toLowerCase() === 'video' ? 'video' :
                       mediaTypeVal.toLowerCase() === 'parallax' ? 'parallax' : 'image',
            parallaxStrength: isNaN(parallaxStrengthVal) ? 100 : parallaxStrengthVal,
            layers: [
              getVal('Layer1'),
              getVal('Layer2'),
              getVal('Layer3'),
              getVal('Layer4'),
              getVal('Layer5')
            ]
          };
        } else {
          // Old single-language format (assume German, try to detect English from Title header)
          const titleHeader = headers.includes('Titel') ? 'Titel' : 'Title';
          const descHeader = headers.includes('Beschreibung') ? 'Beschreibung' : 'Description';

          slide = {
            id: Date.now() + i,
            title_de: getVal(titleHeader),
            title_en: '',
            description_de: getVal(descHeader),
            description_en: '',
            button1Link_de: getVal('Link1'),
            button1Link_en: '',
            button1Text_de: getVal('Link1Text'),
            button1Text_en: '',
            button2Link_de: getVal('Link2'),
            button2Link_en: '',
            button2Text_de: getVal('Link2Text'),
            button2Text_en: '',
            image: getVal('GrafikURL'),
            mediaType: mediaTypeVal.toLowerCase() === 'video' ? 'video' :
                       mediaTypeVal.toLowerCase() === 'parallax' ? 'parallax' : 'image',
            parallaxStrength: isNaN(parallaxStrengthVal) ? 100 : parallaxStrengthVal,
            layers: [
              getVal('Layer1'),
              getVal('Layer2'),
              getVal('Layer3'),
              getVal('Layer4'),
              getVal('Layer5')
            ]
          };
        }

        slides.push(slide);
      }

      renderSlideList();
      if (slides.length > 0) {
        selectSlide(0);
      }
      updatePreview();
    }

    function parseCSVLine(line, delimiter) {
      const values = [];
      let current = '';
      let inQuotes = false;

      for (let i = 0; i < line.length; i++) {
        const char = line[i];
        if (char === '"' && !inQuotes) {
          inQuotes = true;
        } else if (char === '"' && inQuotes) {
          if (line[i + 1] === '"') {
            current += '"';
            i++;
          } else {
            inQuotes = false;
          }
        } else if (char === delimiter && !inQuotes) {
          values.push(current.trim().replace(/^["']|["']$/g, ''));
          current = '';
        } else {
          current += char;
        }
      }
      values.push(current.trim().replace(/^["']|["']$/g, ''));
      return values;
    }

    // Translate URL and store both DE and EN versions
    async function translateUrl(inputId) {
      if (currentSlideIndex < 0) return;

      const input = document.getElementById(inputId);
      const url = input.value.trim();

      if (!url) {
        showToast('Bitte zuerst eine URL eingeben');
        return;
      }

      // Check if it's an aquaventus.org URL
      if (!url.includes('aquaventus.org')) {
        showToast('Nur aquaventus.org URLs werden unterst√ºtzt');
        return;
      }

      // Find the button and show loading state
      const btn = input.parentElement.querySelector('.btn-translate');
      btn.classList.add('loading');
      btn.disabled = true;

      // Determine which field this is (button1Link or button2Link)
      const fieldBase = inputId.replace('slide', '').replace('Link', 'Link');
      const isEnglishUrl = url.includes('/en/');

      try {
        // Fetch the page
        const response = await fetch(url, {
          mode: 'cors',
          credentials: 'omit'
        });

        if (!response.ok) {
          throw new Error(`HTTP ${response.status}`);
        }

        const html = await response.text();

        // Parse the HTML to find hreflang links
        const parser = new DOMParser();
        const doc = parser.parseFromString(html, 'text/html');

        // Look for both German and English hreflang links
        const germanLink = doc.querySelector('link[hreflang="de"]') ||
                          doc.querySelector('link[hreflang="de-DE"]');
        const englishLink = doc.querySelector('link[hreflang="en"]') ||
                           doc.querySelector('link[hreflang="en-US"]') ||
                           doc.querySelector('link[hreflang="en-GB"]');

        let germanUrl = germanLink ? germanLink.href : null;
        let englishUrl = englishLink ? englishLink.href : null;

        // Fallback to language switcher
        if (!germanUrl || !englishUrl) {
          const deSwitcher = doc.querySelector('a[hreflang="de"]') ||
                            doc.querySelector('.wpml-ls-link[href*="aquaventus.org/"]:not([href*="/en/"])');
          const enSwitcher = doc.querySelector('a[hreflang="en"]') ||
                            doc.querySelector('.wpml-ls-link[href*="/en/"]');

          if (!germanUrl && deSwitcher) germanUrl = deSwitcher.href;
          if (!englishUrl && enSwitcher) englishUrl = enSwitcher.href;
        }

        // If we started with one URL, use it for that language
        if (isEnglishUrl) {
          englishUrl = englishUrl || url;
        } else {
          germanUrl = germanUrl || url;
        }

        // Ensure slide has bilingual format
        slides[currentSlideIndex] = migrateSlideFormat(slides[currentSlideIndex]);

        // Store both URLs in the slide data
        const slideFieldDE = fieldBase.charAt(0).toLowerCase() + fieldBase.slice(1) + '_de';
        const slideFieldEN = fieldBase.charAt(0).toLowerCase() + fieldBase.slice(1) + '_en';

        if (germanUrl) slides[currentSlideIndex][slideFieldDE] = germanUrl;
        if (englishUrl) slides[currentSlideIndex][slideFieldEN] = englishUrl;

        // Update the input to show the URL for current language
        const currentLangUrl = currentLanguage === 'en' ? englishUrl : germanUrl;
        if (currentLangUrl) {
          input.value = currentLangUrl;
        }

        // Show success message
        if (germanUrl && englishUrl) {
          showToast('DE + EN URLs gespeichert!');
        } else if (englishUrl) {
          showToast('EN URL gefunden, DE fehlt');
        } else if (germanUrl) {
          showToast('DE URL gefunden, EN fehlt');
        } else {
          showToast('Keine √úbersetzung gefunden');
        }

        // Update translation status
        updateTranslationStatus(slides[currentSlideIndex]);

      } catch (error) {
        console.error('Translate URL error:', error);

        // CORS error - show helpful message
        if (error.message.includes('CORS') || error.message.includes('NetworkError') || error.name === 'TypeError') {
          showToast('CORS-Fehler: √ñffne diese Datei von aquaventus.org');
        } else {
          showToast('Fehler beim Laden: ' + error.message);
        }
      } finally {
        btn.classList.remove('loading');
        btn.disabled = false;
      }
    }

    // Batch translate all URLs for current slide
    async function translateAllUrls() {
      if (currentSlideIndex < 0) return;

      const inputs = ['slideButton1Link', 'slideButton2Link'];
      let translated = 0;

      for (const inputId of inputs) {
        const input = document.getElementById(inputId);
        const url = input.value.trim();

        if (url && url.includes('aquaventus.org')) {
          await translateUrl(inputId);
          translated++;
          // Small delay between requests
          await new Promise(resolve => setTimeout(resolve, 500));
        }
      }

      if (translated === 0) {
        showToast('Keine URLs zum √úbersetzen gefunden');
      }
    }
  </script>

</body>
</html>
